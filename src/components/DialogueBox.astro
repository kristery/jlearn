---
interface DialogueLine {
  speaker: string;
  japanese: string;
  chinese: string;
}

interface Props {
  title?: string;
  scene: string;
  lines: DialogueLine[];
}

const { title = 'æƒ…å¢ƒå°è©±', scene, lines } = Astro.props;

// Determine left/right alignment: first unique speaker goes left, second goes right
const speakers: string[] = [];
for (const line of lines) {
  if (!speakers.includes(line.speaker)) speakers.push(line.speaker);
}
const leftSpeaker = speakers[0] || '';
---
<section class="my-10">
  <h2 class="flex items-center gap-2 text-xl font-bold text-ink mb-2">
    <span class="w-8 h-8 rounded-lg bg-sakura-100 flex items-center justify-center text-sm">ğŸ’¬</span>
    {title}
  </h2>
  <p class="text-sm text-ink-lighter mb-4 ml-10">æƒ…å¢ƒï¼š{scene}</p>
  <div class="space-y-3 max-w-lg mx-auto">
    {lines.map((line) => {
      const isLeft = line.speaker === leftSpeaker;
      return (
        <div class={`flex ${isLeft ? 'justify-start' : 'justify-end'}`}>
          <div class="max-w-[80%]">
            <div class={`flex items-center gap-1.5 mb-1 ${isLeft ? '' : 'justify-end'}`}>
              <span class={`w-2 h-2 rounded-full shrink-0 ${isLeft ? 'bg-matcha-400' : 'bg-sakura-300'}`} />
              <span class={`text-xs font-medium truncate ${isLeft ? 'text-matcha-500' : 'text-sakura-400'}`}>
                {line.speaker}
              </span>
            </div>
            <div class={`rounded-2xl px-4 py-3 ${isLeft ? 'bg-matcha-50 rounded-tl-sm' : 'bg-sakura-50 rounded-tr-sm'}`}>
              <p class="jp-text text-sm font-medium text-ink">{line.japanese}</p>
              <p class="text-xs text-ink-lighter mt-1">{line.chinese}</p>
            </div>
          </div>
        </div>
      );
    })}
  </div>
</section>
